\documentclass[tikz,border=5pt]{standalone}
\usepackage{tikz}
\usepackage{xparse}
\usepackage{musicography}
\usepackage{arrayjobx}

\usetikzlibrary{shapes.geometric}
\usetikzlibrary{calc}

\newif\ifrotateKeySignatures
\newif\ifsaxKeys

% Custom color for pressed keys
\definecolor{keyred}{RGB}{220,0,0}

\pgfkeys{
  /sax/.is family, /sax,
  PalmD/.initial=0,
  PalmDsharp/.initial=0,
  PalmF/.initial=0,
  FrontF/.initial=0,
  B/.initial=0,
  Bbis/.initial=0,
  A/.initial=0,
  G/.initial=0,
  Gsharp/.initial=0,
  LowB/.initial=0,
  Csharp/.initial=0,
  LowBflat/.initial=0,
  F/.initial=0,
  SideE/.initial=0,
  SideC/.initial=0,
  SideBflat/.initial=0,
  E/.initial=0,
  D/.initial=0,
  Dsharp/.initial=0,
  C/.initial=0,
  HighFsharp/.initial=0,
  SideFsharp/.initial=0,
}
\newcommand{\drawSimpleSaxDiagram}[1]{%
  \begingroup
  \pgfkeys{/sax, #1}%
  % Helper macro to get fill color
  \newcommand{\keycolor}[1]{%
    \ifnum\pgfkeysvalueof{/sax/##1}=1 keyred\else white\fi
  }%
  \begin{tikzpicture}
    \begin{scope}[inner sep=0pt]
    % Palm keys
    \node (PalmD) at (231pt,50pt) [draw, ellipse, minimum width=0.06cm, minimum height=0.26cm, fill=\keycolor{PalmD}] {};
    \node (PalmDsharp) at ($(PalmD)+(1.7pt,5.1pt)$) [draw, ellipse, minimum width=0.06cm, minimum height=0.26cm, fill=\keycolor{PalmDsharp}] {};
    \node (PalmF) at ($(PalmD)+(3.7pt,2.6pt)$) [draw, ellipse, minimum width=0.06cm, minimum height=0.26cm, fill=\keycolor{PalmF}] {};
    % Main finger keys
    \node (FrontF) at ($(227pt,52.2pt)$) [draw, ellipse, minimum height=0.09cm, minimum width=0.17cm, fill=\keycolor{FrontF}] {};
    \node (B) at (227pt,48.2pt) [draw, circle, minimum size=4.1pt, xshift=-0.3pt, fill=\keycolor{B}] {};
    \node (Bbis) at ($(B)+(1.02pt,-3.3pt)$) [draw, circle, minimum size=2.4pt, fill=\keycolor{Bbis}] {};
    \node (A) at ($(227pt,50pt)+(0,-9.18pt)$) [draw, circle, minimum size=4.536pt, fill=\keycolor{A}] {};
    \node (G) at ($(A)+(0,-5.10pt)$) [draw, circle, minimum size=4.536pt, fill=\keycolor{G}] {};
    % Break
    \draw [] [xshift=-3](227pt,31.8pt) -- ++(6pt,0pt);
    % Plane keys
    \node (Gsharp) at (233pt,38pt) [draw, shape=semicircle, rotate=0, minimum width=0.15cm, fill=\keycolor{Gsharp}] {};
    \node (Csharp) at ($(Gsharp)+(0pt,-0.85pt)$) [draw, rectangle, rounded corners=0.025cm, minimum width=2.3pt, minimum height=1.7pt, anchor=north west, fill=\keycolor{Csharp}] {};
    \node (LowB) at ($(Gsharp)+(0pt,-0.85pt)$) [draw, rectangle, rounded corners=0.025cm, minimum width=2.3pt, minimum height=1.7pt, anchor=north east, fill=\keycolor{LowB}] {};
    \node (LowBflat) at ($(Gsharp)+(0pt,-4.0pt)$) [draw, shape=semicircle, rotate=180, minimum width=0.15cm, fill=\keycolor{LowBflat}] {};
    % Lower stack keys
    \node (F) at (227pt,28pt) [draw, circle, minimum size=4.536pt, fill=\keycolor{F}] {};
    % Side keys
    \node (SideE) at (221.55pt,38pt) [draw, rectangle, rounded corners=0.025cm, minimum width=1.7pt, minimum height=4.1pt, fill=\keycolor{SideE}] {};
    \node (SideC) at ($(SideE)+(0pt,-4.5pt)$) [draw, rectangle, rounded corners=0.025cm, minimum width=1.7pt, minimum height=4.1pt, fill=\keycolor{SideC}] {};
    \node (SideBflat) at ($(SideC)+(0pt,-4.5pt)$) [draw, rectangle, rounded corners=0.025cm, minimum width=1.7pt, minimum height=4.1pt, fill=\keycolor{SideBflat}] {};
    % Lower stack keys
    \node (E) at ($(F)+(0pt,-5.10pt)$) [draw, circle, minimum size=4.536pt, fill=\keycolor{E}] {};
    \node (D) at ($(E)+(0pt,-5.10pt)$) [draw, circle, minimum size=4.536pt, fill=\keycolor{D}] {};
    % Pinky keys
    \node (Dsharp) at ($(D)+(0pt,-4.35pt)$) [draw, shape=semicircle, rotate=0, minimum width=5pt, minimum height=2.5pt, fill=\keycolor{Dsharp}] {};
    \node (C) at ($(Dsharp)+(0pt,-2.7pt)$) [draw, shape=semicircle, rotate=180, minimum width=5pt, minimum height=2.5pt, fill=\keycolor{C}] {};
    % Low C/Eb cluster
    \node (HighFsharp) at (221.55pt,21pt) [draw, rectangle, rounded corners=0.025cm, minimum width=2pt, minimum height=4.5pt, fill=\keycolor{HighFsharp}] {};
    \node (SideFsharp) at ($(HighFsharp)+(0pt,-6pt)$) [draw, ellipse, minimum width=0.1cm, minimum height=0.16cm, fill=\keycolor{SideFsharp}] {};
    \end{scope}
  \end{tikzpicture}
  \endgroup
}

\newcommand{\noteName}[1]{%
  \ifcase#1
      C%
  \or D$\flat$%
  \or D%
  \or E$\flat$%
  \or E%
  \or F%
  \or F$\sharp$%
  \or G%
  \or A$\flat$%
  \or A%
  \or B$\flat$%
  \or B%
  \else ?%
  \fi
}
\newcommand{\noteNameAlt}[1]{%
  \ifcase#1
      C%
  \or D$\flat$%
  \or D%
  \or E$\flat$%
  \or E%
  \or F%
  \or G$\flat$%
  \or G%
  \or A$\flat$%
  \or A%
  \or B$\flat$%
  \or B%
  \else ?%
  \fi
}
\newcommand{\noteNameMinor}[1]{%
  \ifcase#1
      C%
  \or C$\sharp$%
  \or D%
  \or D$\sharp$%
  \or E%
  \or F%
  \or F$\sharp$%
  \or G%
  \or G$\sharp$%
  \or A%
  \or B$\flat$%
  \or B%
  \else ?%
  \fi
}

\newcommand{\sheetdistance}[1]{%
  \ifcase#1
      0.6 % -            C
  \or 0.6 % --
  \or 0.7
  \or 0.8 % --------------
  \or 0.7
  \or 0.6 % --
  \or 0.6 % -            F#
  \or 0.6 % --
  \or 0.7
  \or 0.8 % --------------
  \or 0.7
  \or 0.6 % --
  \else ?%
  \fi
}

\newcommand{\convert}[1]{%
  \ifcase#1
      0
  \or -5
  \or 2
  \or -3
  \or 4
  \or -1
  \or 6
  \or 1
  \or -4
  \or 3
  \or -2
  \or 5
  \else ?%
  \fi
}

\NewDocumentCommand{\getNote}{ O{0} m }{%
  \pgfmathtruncatemacro{\idx}{mod(#2+#1+12,12)}%
  \noteName{\idx}%
}
\NewDocumentCommand{\getNoteAlt}{ O{0} m }{%
  \pgfmathtruncatemacro{\idx}{mod(#2+#1+12,12)}%
  \noteNameAlt{\idx}%
}
\NewDocumentCommand{\getNoteAltAlt}{ O{0} m }{%
  \pgfmathtruncatemacro{\idx}{mod(#2+#1+12,12)}%
  \noteNameMinor{\idx}%
}

\def\col{blue!30}

% Define positions of sharps and flats in treble clef (relative to bottom staff line index 0)
% For y positions we use: 0=line1(E), 0.5=space1(F), 1=line2(G), 1.5=space2(A), 2=line3(B), 2.5=space3(C), 3=line4(D), 3.5=space4(E), 4=line5(F)
% Sharp order: F, C, G, D, A, E, B  -> y {4,2.5,4.8,3,1.5,3.5,2}
% flat order:  B, E, A, D, G, C, F  -> y {2,3.5,1.5,3,1,2.5,4}
\newcommand{\sharpPos}{4,2.5,4.5,3,1.5,3.5,2}
\newcommand{\flatPos}{2,3.5,1.5,3,1,2.5,4}

\def\staffWidth{49.8pt}
\def\staffStep{6.23pt}
\def\sharpAdjustment{4.09pt}
\def\flatAdjustment{3.984pt}

% Macro to draw staff and key signature (compact, with vertical lines)
\newcommand{\drawKeySignature}[1]{%
    % #1 is a pitch-class index (0..11). Use \convert to get number of accidentals.
    \begingroup
      \edef\accraw{\convert{#1}}%
      \pgfmathtruncatemacro{\acc}{\accraw}%
      \begin{tikzpicture}[baseline=(staff.base),scale=0.50,every node/.style={inner sep=0pt,outer sep=0pt}]
        \coordinate (staff) at (0,0);
        % compact staff parameters
        % short staff lines
        \foreach \y in {0,...,4}
        {\draw[line width=0.4pt] (0,\y*\staffStep) -- (\staffWidth,\y*\staffStep);}
        % thin vertical bar lines at left and right to visually bound the staff
        \draw[line width=0.4pt] (0,0) -- (0,4*\staffStep) --
                                (\staffWidth,4*\staffStep) -- (\staffWidth,0) -- cycle;
        % sharps
        \ifnum\acc>0
          \pgfmathtruncatemacro{\countacc}{\acc}
          \foreach [count=\i] \pos in \sharpPos {%
            \ifnum\i>\countacc\relax\else
              % compute x position so accidentals form a compact cluster
              \pgfmathsetmacro{\xpos}{0.25pt*(\i-1)+0.23pt}%
              \node at (\xpos,\pos*\staffStep-\sharpAdjustment) {$\musSharp$};
            \fi
          }
        \fi
        % flats
        \ifnum\acc<0
          \pgfmathtruncatemacro{\countacc}{abs(\acc)}
          \foreach [count=\i] \pos in \flatPos {%
            \ifnum\i>\countacc\relax\else
              \pgfmathsetmacro{\xpos}{0.25pt*(\i-1)+0.23pt}%
              \node at (\xpos,\pos*\staffStep-\flatAdjustment) {$\musFlat$};
            \fi
          }
        \fi
      \end{tikzpicture}
    \endgroup
}

\newcommand{\drawCircularSectors}[4]{%
  % #1 = inner radius, #2 = ring width (outer = inner + width), #3 = number of divisions, #4 = placement macro
  \pgfmathsetmacro{\innerradius}{#1}%
  \pgfmathsetmacro{\widthcircle}{#2}%
  \pgfmathsetmacro{\outerradius}{\innerradius+\widthcircle}%
  \pgfmathsetmacro{\anglestep}{360/#3}%
  \pgfmathsetmacro{\offset}{\anglestep/2}%
  \pgfmathtruncatemacro{\N}{#3-1}%
  \foreach \j in {0,...,\N} {%
      \pgfmathsetmacro{\startangle}{90-\j*\anglestep+\offset}%
      \pgfmathsetmacro{\endangle}{\startangle-\anglestep}%
      \pgfmathsetmacro{\angle}{\startangle-\anglestep/2}%
      \pgfmathsetmacro{\midradius}{\innerradius+\widthcircle/2}%

      \fill[\col]
          (\startangle:\innerradius) arc (\startangle:\endangle:\innerradius) --
          (\endangle:\outerradius) arc (\endangle:\startangle:\outerradius) -- cycle;

      \draw[thick] (\startangle:\innerradius) -- (\startangle:\outerradius);
      \draw[thick] (\endangle:\innerradius) -- (\endangle:\outerradius);

      #4{\j}{\angle}{\midradius}{\outerradius}%
  }

  % Draw circles
  \draw[thick] (0,0) circle (\outerradius);
  \draw[thick] (0,0) circle (\innerradius);
}

\def\saxnotesdistance{0.15}

\newcommand{\sectorNodeDefault}[4]{%
  % #1 index, #2 angle, #3 midradius, #4 outerradius
  \pgfmathtruncatemacro{\pc}{mod(7*#1,12)}%
  \def\note{\getNote{\pc}}%
  \def\saxnote{\getNoteAlt[-2]{\pc}}%

  \ifrotateKeySignatures
    \node[font=\bfseries\large, inner sep=-1.8pt, rotate=#2-\counterrotation] (main) at (#2:#3+\labeloffset) {\note};
    \node[font=\scriptsize, anchor=north, rotate=#2-\counterrotation, text=white!30!black] at (main.south) {\saxnote};
  \else
    \node[font=\bfseries\large, inner sep=-1.8pt] (main) at (#2:#3) {\note};
    \node[font=\scriptsize, anchor=north, text=white!30!black] at (main.south) {\saxnote};
  \fi

  \ifrotateKeySignatures
    \node[anchor=base, rotate=#2-\counterrotation, shift={(0,-\staffStep)}] at (#2:{\rotatedsheetdistance+#4}) {\drawKeySignature{\pc}};
  \else
    \node[anchor=base, yshift={-1*\staffStep}] at (#2:{\sheetdistance{\j}+#4}) {\drawKeySignature{\pc}};
  \fi

  % \ifsaxKeys
  %   \node[anchor=base, rotate=#2-\counterrotation, shift={(0,-\staffStep)}] at (#2:{\saxnotesdistance+2*\rotatedsheetdistance+#4}) {\simpleSaxDiagram{\pc}};
  % \fi
}

\newcommand{\innerSectorNoteMinor}[4]{%
  \pgfmathtruncatemacro{\pc}{mod(7*#1 + 9,12)}%
  \def\note{\getNoteAltAlt{\pc}}%

  \ifrotateKeySignatures
    \node[font=\bfseries\large, inner sep=-1.8pt, rotate=#2-\counterrotation] at (#2:#3) {\small \note m};
  \else
    \node[font=\bfseries\large, inner sep=-1.8pt] at (#2:#3) {\small \note m};
  \fi
}

% Note names for the above MIDI numbers
\newcommand{\saxNoteName}[1]{%
  \pgfmathtruncatemacro{\idx}{#1-58}
  \ifcase\idx
      B$\flat$3
  \or B3
  \or C4
  \or C$\sharp$4
  \or D4
  \or E$\flat$4
  \or E4
  \or F4
  \or F$\sharp$4
  \or G4
  \or A$\flat$4
  \or A4
  \or B$\flat$4
  \or B4
  \or C5
  \or C$\sharp$5
  \or D5
  \or E$\flat5$
  \or E5
  \or F5
  \or F$\sharp$5
  \else ?\fi
}

% Macro: takes a MIDI note number, subtracts 58, and draws the correct fingering
\newcommand{\saxFingering}[1]{%
  \pgfmathtruncatemacro{\idx}{#1-58}
  \ifcase\idx
       \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1,D=1,C=1,LowBflat=1}       % Low Bb (MIDI 58)
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1,D=1,C=1,LowB=1}           % B
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1,D=1,C=1}                  % C
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1,D=1,C=1,Csharp=1}         % C#
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1,D=1}                      % D
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1,D=1,Dsharp=1}             % D#
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1,E=1}                          % E
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,F=1}                              % F
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,E=1}                              % F#
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1}                                  % G
   \or \drawSimpleSaxDiagram{B=1,A=1,G=1,Gsharp=1}                         % G#
   \or \drawSimpleSaxDiagram{B=1,A=1}                                      % A
   \or \drawSimpleSaxDiagram{B=1,A=1,SideBflat=1}                          % Bb
   \or \drawSimpleSaxDiagram{B=1}                                          % B
   \or \drawSimpleSaxDiagram{A=1}                                             % C (high)
   \or \drawSimpleSaxDiagram{}                                     % C# (high)
   \or \drawSimpleSaxDiagram{PalmD=1}                                      % D (high, palm)
   \or \drawSimpleSaxDiagram{PalmD=1,PalmDsharp=1}                         % Eb (high, palm)
   \or \drawSimpleSaxDiagram{PalmD=1,PalmDsharp=1,SideE=1}                                 % E (high, palm)
   \or \drawSimpleSaxDiagram{PalmD=1,PalmDsharp=1,SideE=1,PalmF=1}                              % F (high, palm)
   \or \drawSimpleSaxDiagram{PalmD=1,PalmDsharp=1,SideE=1,PalmF=1,HighFsharp=1}                % F# (high, palm)
  \else
    % Default: all keys up
    \drawSimpleSaxDiagram{}
  \fi
}


\begin{document}
\rotateKeySignaturestrue
\saxKeysfalse
\def\rotatedsheetdistance{0.4}
\def\counterrotation{90}
\def\labeloffset{0.055}
\begin{tikzpicture}
\drawCircularSectors{2.1pt}{1.0pt}{12}{\sectorNodeDefault}
\drawCircularSectors{1.5pt}{0.6pt}{12}{\innerSectorNoteMinor}
\end{tikzpicture}
\clearpage
\rotateKeySignaturestrue
\saxKeystrue
\def\rotatedsheetdistance{0.6}
\def\counterrotation{0}
\def\labeloffset{0}
\begin{tikzpicture}
\drawCircularSectors{2.1pt}{1.0pt}{12}{\sectorNodeDefault}
\drawCircularSectors{1.2pt}{0.9pt}{12}{\innerSectorNoteMinor}
\end{tikzpicture}
\clearpage
\begin{tikzpicture}
\rotateKeySignaturesfalse
\saxKeysfalse
\def\labeloffset{0}
\drawCircularSectors{2.1pt}{1.0pt}{12}{\sectorNodeDefault}
\drawCircularSectors{1.3pt}{0.8pt}{12}{\innerSectorNoteMinor}
\end{tikzpicture}

% Fingering chart page



% Alto sax standard fingerings for notes D4 (MIDI 50) to F#5 (MIDI 78)
% Each entry: {PalmD}{PalmDsharp}{PalmF}{FrontF}{B}{Bbis}{A}{G}{Gsharp}{LowB}{Csharp}{LowBflat}{F}

% \begin{center}
% \begin{tabular}{cccc}
% \foreach \n in {0,...,16} {
%   \begin{tabular}{c}
%     \saxFingering{\n} \\
%     \saxNoteName{\n}
%   \end{tabular}
%   % Add column separator except after last column
%   \ifnum\n=3 & \fi
%   \ifnum\n=7 & \fi
%   \ifnum\n=11 & \fi
%   % Add row separator after every 4 columns
%   \ifnum\n=3 \\\fi
%   \ifnum\n=7 \\\fi
%   \ifnum\n=11 \\\fi
% }
% \end{tabular}
% \end{center}

% \saxFingering{3}

%\drawSimpleSaxDiagram{PalmD=1,PalmF=1,B=1,A=0,G=1,LowB=1}
%\clearpage
\begin{center}
\begin{tikzpicture}
\foreach \x in {58,...,78} {
  \node at (18pt*\x,        0pt) {\saxFingering{\x}};
  \node at (18pt*\x-3pt,      -34pt) {\saxNoteName{\x}};
}
\end{tikzpicture}
\end{center}

%   \drawSaxFingeringFromMidi{58}
% \drawSaxFingeringFromMidi{64}
% \drawSaxFingeringFromMidi{65}

\end{document}
